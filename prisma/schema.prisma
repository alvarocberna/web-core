// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Proyecto {
  id              String   @id @default(uuid())
  nombre_proyecto String
  descripcion     String
  cliente         String
  fecha_inicio    DateTime
  //REL N:M 
  usuario        Usuario[] @relation("fk_usu_pro")
  articulo       Articulo[] @relation("fk_art_pro")
  actividad         Actividad[]        @relation("fk_act_pro")
}

model Usuario {
  id            String   @id @default(uuid())
  nombre        String
  apellido      String
  email         String   @unique
  fechaCreacion DateTime
  password      String
  hashedRt      String?
  rol           String
  proyecto_id   String
  actividad_id  String?
  //REL M:N
  proyecto      Proyecto @relation(name: "fk_usu_pro", fields: [proyecto_id], references: [id], onDelete: Cascade)
  //REL N:M 
  actividad         Actividad[]        @relation("fk_act_usu")
}

model Articulo {
    id                   String              @id @default(uuid())
    nro_articulo         Int
    titulo               String
    subtitulo            String
    autor                String
    fecha_publicacion    DateTime
    fecha_actualizacion  DateTime?
    status               String
    slug                 String    
    image_url            String?
    image_alt            String?
    image_position       String?         
    autor_id             String
    proyecto_id          String
    //REL M:N
    proyectos            Proyecto @relation(name: "fk_art_pro", fields: [proyecto_id], references: [id], onDelete: Cascade)
    //REL N:M
    sec_articulo       SecArticulo[]      @relation("fk_sec_art")
    actividad         Actividad[]        @relation("fk_act_art")
}

model SecArticulo {
    id          String @id @default(uuid())
    nro_seccion Int
    titulo_sec      String
    contenido_sec   String
    image_url       String?
    image_alt       String?
    image_position  String?
    articulo_id String
    proyecto_id String
    //REL M:N
    articulo    Articulo @relation(name: "fk_sec_art", fields: [articulo_id], references: [id], onDelete: Cascade)
}

model Actividad {
    id                    String   @id @default(uuid())
    accion                String
    titulo_articulo       String
    responsable           String
    fecha                 DateTime
    proyecto_id           String
    usuario_id            String?
    articulo_id           String?
    //REL M:N
    proyecto             Proyecto @relation(name: "fk_act_pro", fields: [proyecto_id], references: [id], onDelete: Cascade)
    usuario              Usuario? @relation(name: "fk_act_usu", fields: [usuario_id], references: [id], onDelete: SetNull)
    articulo             Articulo? @relation(name: "fk_act_art", fields: [articulo_id], references: [id], onDelete: SetNull)
}
